# å½©ç¥¨ç³»ç»Ÿç¯å¢ƒæ­å»ºæŒ‡å—

## ğŸ–¥ï¸ **ç³»ç»Ÿç¯å¢ƒè¦æ±‚**

### æ“ä½œç³»ç»Ÿ
- **Linux**: Ubuntu 18.04+, CentOS 7+, Debian 9+
- **Windows**: Windows 10+, Windows Server 2016+
- **macOS**: macOS 10.14+

### æ ¸å¿ƒç¯å¢ƒ
- **PHP**: >= 8.0 (æ¨è PHP 8.1 æˆ– 8.2)
- **MySQL**: >= 5.7 (æ¨è MySQL 8.0)
- **WebæœåŠ¡å™¨**: Nginx 1.18+ æˆ– Apache 2.4+
- **Composer**: æœ€æ–°ç‰ˆæœ¬

## ğŸ“¦ **ç¯å¢ƒå®‰è£…æ­¥éª¤**

### 1. å®‰è£… PHP 8.0+

#### Ubuntu/Debian:
```bash
# æ·»åŠ PHPæº
sudo apt update
sudo add-apt-repository ppa:ondrej/php
sudo apt update

# å®‰è£…PHP 8.1åŠæ‰©å±•
sudo apt install php8.1 php8.1-fpm php8.1-cli php8.1-common php8.1-mysql \
php8.1-zip php8.1-gd php8.1-mbstring php8.1-curl php8.1-xml php8.1-bcmath \
php8.1-json php8.1-openssl php8.1-pdo php8.1-tokenizer php8.1-fileinfo

# éªŒè¯å®‰è£…
php -v
```

#### CentOS/RHEL:
```bash
# å®‰è£…Remiæº
sudo yum install epel-release yum-utils
sudo yum install http://rpms.remirepo.net/enterprise/remi-release-8.rpm
sudo yum-config-manager --enable remi-php81

# å®‰è£…PHP
sudo yum install php php-fpm php-cli php-common php-mysqlnd php-zip \
php-gd php-mbstring php-curl php-xml php-bcmath php-json php-openssl \
php-pdo php-tokenizer php-fileinfo

php -v
```

#### Windows:
```bash
# ä¸‹è½½PHP 8.1 Windowsç‰ˆæœ¬
https://windows.php.net/download/

# è§£å‹åˆ° C:\php
# é…ç½®ç¯å¢ƒå˜é‡
# å¤åˆ¶ php.ini-development ä¸º php.ini
# å¯ç”¨å¿…è¦æ‰©å±•
```

### 2. å®‰è£… MySQL 8.0

#### Ubuntu/Debian:
```bash
# å®‰è£…MySQL
sudo apt update
sudo apt install mysql-server

# å®‰å…¨é…ç½®
sudo mysql_secure_installation

# å¯åŠ¨æœåŠ¡
sudo systemctl start mysql
sudo systemctl enable mysql
```

#### CentOS/RHEL:
```bash
# å®‰è£…MySQL
sudo yum install mysql-server

# å¯åŠ¨æœåŠ¡
sudo systemctl start mysqld
sudo systemctl enable mysqld

# è·å–ä¸´æ—¶å¯†ç 
sudo grep 'temporary password' /var/log/mysqld.log
```

### 3. å®‰è£… Nginx

#### Ubuntu/Debian:
```bash
sudo apt install nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### CentOS/RHEL:
```bash
sudo yum install nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 4. å®‰è£… Composer

```bash
# ä¸‹è½½å¹¶å®‰è£…Composer
curl -sS https://getcomposer.org/installer | php
sudo mv composer.phar /usr/local/bin/composer

# éªŒè¯å®‰è£…
composer --version
```

## ğŸ”§ **ç³»ç»Ÿé…ç½®**

### 1. PHPé…ç½® (php.ini)

```ini
# åŸºæœ¬é…ç½®
memory_limit = 256M
max_execution_time = 300
max_input_time = 300
upload_max_filesize = 50M
post_max_size = 50M

# æ‰©å±•é…ç½®
extension=mysqli
extension=pdo_mysql
extension=json
extension=curl
extension=mbstring
extension=openssl
extension=fileinfo
extension=tokenizer
extension=xml
extension=gd
extension=zip

# æ—¶åŒºè®¾ç½®
date.timezone = Asia/Shanghai
```

### 2. Nginxé…ç½®

åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š`/etc/nginx/sites-available/lottery`

```nginx
server {
    listen 80;
    server_name your-domain.com;  # æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå
    root /path/to/æ–°ç³»ç»Ÿ/public;  # æ›¿æ¢ä¸ºå®é™…è·¯å¾„
    index index.php index.html;

    # å‰å°é…ç½®
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # åå°é…ç½®
    location /admin {
        try_files $uri $uri/ /admin.php?$query_string;
    }

    # PHPå¤„ç†
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # WebSocketä»£ç† (å¯é€‰)
    location /ws/ {
        proxy_pass http://127.0.0.1:15531;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/lottery /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 3. MySQLæ•°æ®åº“é…ç½®

```bash
# ç™»å½•MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE shicai CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'lottery_user'@'localhost' IDENTIFIED BY 'your_strong_password';
GRANT ALL PRIVILEGES ON shicai.* TO 'lottery_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;

# å¯¼å…¥æ•°æ®åº“
cd /path/to/æ–°ç³»ç»Ÿ
mysql -u lottery_user -p shicai < think_admin.sql
```

## ğŸš€ **ç³»ç»Ÿéƒ¨ç½²**

### 1. éƒ¨ç½²ä»£ç 

```bash
# è¿›å…¥Webæ ¹ç›®å½•
cd /var/www/html

# ä¸Šä¼ æˆ–å…‹éš†ä»£ç åˆ°æ­¤ç›®å½•
# å‡è®¾ä»£ç åœ¨ /var/www/html/æ–°ç³»ç»Ÿ

# è®¾ç½®æƒé™
sudo chown -R www-data:www-data /var/www/html/æ–°ç³»ç»Ÿ
sudo chmod -R 755 /var/www/html/æ–°ç³»ç»Ÿ
sudo chmod -R 777 /var/www/html/æ–°ç³»ç»Ÿ/runtime
sudo chmod -R 777 /var/www/html/æ–°ç³»ç»Ÿ/public
```

### 2. é…ç½®æ•°æ®åº“è¿æ¥

ç¼–è¾‘ï¼š`æ–°ç³»ç»Ÿ/config/database.php`

```php
return [
    'default' => 'mysql',
    'connections' => [
        'mysql' => [
            'type'     => 'mysql',
            'hostname' => '127.0.0.1',
            'database' => 'shicai',
            'username' => 'lottery_user',
            'password' => 'your_strong_password',
            'hostport' => '3306',
            'charset'  => 'utf8mb4',
        ],
    ],
];
```

### 3. å®‰è£…ä¾èµ–

```bash
cd /var/www/html/æ–°ç³»ç»Ÿ
composer install --no-dev --optimize-autoloader
```

### 4. å¯åŠ¨ç³»ç»Ÿ

```bash
# ç»™å¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start_system.sh

# å¯åŠ¨ç³»ç»Ÿ
./start_system.sh start
```

## ğŸ” **éªŒè¯å®‰è£…**

### 1. æ£€æŸ¥PHPç¯å¢ƒ

```bash
# æ£€æŸ¥PHPç‰ˆæœ¬å’Œæ‰©å±•
php -v
php -m | grep -E "(mysql|pdo|json|curl|mbstring|openssl)"
```

### 2. æ£€æŸ¥MySQLè¿æ¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u lottery_user -p shicai -e "SHOW TABLES;"
```

### 3. æ£€æŸ¥WebæœåŠ¡

```bash
# è®¿é—®æµ‹è¯•
curl -I http://your-domain.com
curl -I http://your-domain.com/admin
```

### 4. æ£€æŸ¥WebSocketæœåŠ¡

```bash
# æŸ¥çœ‹è¿›ç¨‹
./start_system.sh status

# æ£€æŸ¥ç«¯å£
netstat -tulpn | grep -E "(8080|15531|15532|15533|15534|15535|15537|15538)"
```

## ğŸ”’ **å®‰å…¨é…ç½®**

### 1. é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian
sudo ufw allow 22        # SSH
sudo ufw allow 80        # HTTP
sudo ufw allow 443       # HTTPS
sudo ufw allow 8080      # åº”ç”¨ç«¯å£
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

### 2. SSLè¯ä¹¦ (æ¨è)

```bash
# ä½¿ç”¨Let's Encrypt (å…è´¹)
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

### 3. ç³»ç»Ÿä¼˜åŒ–

```bash
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
echo "* soft nofile 65535" >> /etc/security/limits.conf
echo "* hard nofile 65535" >> /etc/security/limits.conf

# PHP-FPMä¼˜åŒ–
sudo vim /etc/php/8.1/fpm/pool.d/www.conf
# è°ƒæ•´ pm.max_children, pm.start_servers, pm.min_spare_servers, pm.max_spare_servers
```

## ğŸ“± **è®¿é—®ç³»ç»Ÿ**

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **å‰å°**: http://your-domain.com
- **åå°**: http://your-domain.com/admin
- **WebSocketæ¸¸æˆ**: ws://your-domain.com:15531-15538

## ğŸ› ï¸ **å¸¸ç”¨ç»´æŠ¤å‘½ä»¤**

```bash
# ç³»ç»Ÿç®¡ç†
./start_system.sh start     # å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start_system.sh stop      # åœæ­¢æ‰€æœ‰æœåŠ¡
./start_system.sh status    # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./start_system.sh restart   # é‡å¯æ‰€æœ‰æœåŠ¡

# æ—¥å¿—æŸ¥çœ‹
tail -f runtime/log/error.log     # åº”ç”¨é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log  # Nginxé”™è¯¯æ—¥å¿—
tail -f /var/log/mysql/error.log  # MySQLé”™è¯¯æ—¥å¿—

# æ€§èƒ½ç›‘æ§
top                         # ç³»ç»Ÿèµ„æºç›‘æ§
netstat -tulpn             # ç«¯å£ç›‘æ§
mysql -e "SHOW PROCESSLIST;" # æ•°æ®åº“è¿æ¥ç›‘æ§
```

## ğŸ†˜ **å¸¸è§é—®é¢˜è§£å†³**

### 1. PHPæ‰©å±•ç¼ºå¤±
```bash
# æ£€æŸ¥å¹¶å®‰è£…ç¼ºå¤±æ‰©å±•
php -m | grep extension_name
sudo apt install php8.1-extension_name
```

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
sudo systemctl status mysql
# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
# éªŒè¯æ•°æ®åº“ç”¨æˆ·æƒé™
```

### 3. WebSocketè¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tulpn | grep 15531
# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
ps aux | grep workerman
```

---

**æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤éƒ¨ç½²åï¼Œæ‚¨çš„å½©ç¥¨ç³»ç»Ÿå°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼** ğŸ‰